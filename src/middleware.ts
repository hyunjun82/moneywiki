import { NextRequest, NextResponse } from "next/server";

// 슬러그 → 카테고리 매핑 (빌드 시점에 하드코딩)
// 기존 URL에서 새 URL로 301 리다이렉트하기 위해 필요
const slugCategoryMap: Record<string, string> = {
  "4대보험": "경제",
  "ISA계좌": "경제",
  "가상자산-세금": "세금",
  "건강보험료": "경제",
  "계약갱신청구권-거절사유": "부동산",
  "계약갱신청구권-기간": "부동산",
  "계약갱신청구권-매매": "부동산",
  "계약갱신청구권-복비": "부동산",
  "계약갱신청구권-실거주": "부동산",
  "계약갱신청구권-오피스텔": "부동산",
  "계약갱신청구권-월세": "부동산",
  "계약갱신청구권-재계약": "부동산",
  "계약갱신청구권-중도해지": "부동산",
  "계약갱신청구권-행사방법": "부동산",
  "교육비공제": "세금",
  "국민기초생활보장": "경제",
  "국민연금": "경제",
  "권리금-보호": "부동산",
  "근로계약서": "법률",
  "근로소득세": "세금",
  "근로장려금": "경제",
  "금융투자소득세": "세금",
  "기부금공제": "세금",
  "기초연금": "경제",
  "노인장기요양보험": "경제",
  "다가구주택-전세-주의사항": "부동산",
  "다주택자-세금": "세금",
  "대항력-발생-시점": "부동산",
  "등록면허세": "세금",
  "무단전대-법적-대응": "부동산",
  "묵시적갱신": "부동산",
  "배당소득세": "세금",
  "법인세": "세금",
  "보증금-일부반환": "부동산",
  "부가가치세": "세금",
  "부동산-취득세": "부동산",
  "부양가족공제": "세금",
  "분양권-전매": "부동산",
  "사업자등록": "세금",
  "상속세": "세금",
  "소액임차인-최우선변제권": "부동산",
  "실업급여-수급-조건": "경제",
  "실업급여": "근로",
  "아동수당": "경제",
  "양도소득세": "세금",
  "연금저축": "경제",
  "연말정산-1주택자": "연말정산",
  "연말정산-IRP-세액공제": "세금",
  "연말정산-간소화서비스-이용방법": "세금",
  "연말정산-개인연금-공제": "연말정산",
  "연말정산-건강검진": "연말정산",
  "연말정산-건강보험료": "연말정산",
  "연말정산-결정세액": "연말정산",
  "연말정산-경로우대-공제": "세금",
  "연말정산-경정청구": "세금",
  "연말정산-고용보험료": "연말정산",
  "연말정산-고향사랑기부금": "연말정산",
  "연말정산-공제신고서": "연말정산",
  "연말정산-공제율": "연말정산",
  "연말정산-공제한도": "연말정산",
  "연말정산-과세표준": "연말정산",
  "연말정산-교복-구입비": "연말정산",
  "연말정산-교육비-세액공제": "세금",
  "연말정산-국민연금-공제": "연말정산",
  "연말정산-국외-교육비-공제": "세금",
  "연말정산-근로소득공제": "연말정산",
  "연말정산-근로소득세액공제": "세금",
  "연말정산-급식비": "연말정산",
  "연말정산-기납부세액": "세금",
  "연말정산-기본공제-대상": "연말정산",
  "연말정산-기부금-세액공제": "세금",
  "연말정산-기숙사비": "연말정산",
  "연말정산-기타소득": "연말정산",
  "연말정산-난임시술비-공제": "세금",
  "연말정산-난임시술비": "연말정산",
  "연말정산-다자녀-세액공제": "연말정산",
  "연말정산-대중교통-공제": "세금",
  "연말정산-대학교-등록금-공제": "세금",
  "연말정산-대학교-등록금": "연말정산",
  "연말정산-도서-공연-공제": "세금",
  "연말정산-도서-공연": "연말정산",
  "연말정산-라식-라섹": "연말정산",
  "연말정산-맞벌이-절세-전략": "세금",
  "연말정산-무주택-세대주": "연말정산",
  "연말정산-발달재활서비스-공제": "연말정산",
  "연말정산-배우자-공제": "연말정산",
  "연말정산-보장성보험료-공제": "세금",
  "연말정산-보청기": "연말정산",
  "연말정산-보험료-공제": "연말정산",
  "연말정산-부녀자-공제": "세금",
  "연말정산-부양가족-공제": "세금",
  "연말정산-부업소득": "연말정산",
  "연말정산-비과세-소득": "세금",
  "연말정산-산후조리원-공제": "세금",
  "연말정산-산후조리원": "연말정산",
  "연말정산-세액감면": "연말정산",
  "연말정산-세액공제-소득공제-차이": "세금",
  "연말정산-세액공제-순서": "연말정산",
  "연말정산-세율": "세금",
  "연말정산-소기업-소상공인-공제": "세금",
  "연말정산-소득-지출명세서": "연말정산",
  "연말정산-소득공제-세액공제-차이": "연말정산",
  "연말정산-손택스": "연말정산",
  "연말정산-신고-기한": "세금",
  "연말정산-신용카드-공제-한도": "세금",
  "연말정산-신용카드-소득공제-계산": "세금",
  "연말정산-신용카드-체크카드-비교": "연말정산",
  "연말정산-신혼부부": "연말정산",
  "연말정산-싱글-절세": "연말정산",
  "연말정산-아르바이트": "연말정산",
  "연말정산-안경-구입비": "연말정산",
  "연말정산-안경구입비-공제": "세금",
  "연말정산-약국비": "연말정산",
  "연말정산-연금소득": "연말정산",
  "연말정산-연금저축-공제": "세금",
  "연말정산-외국납부세액공제": "세금",
  "연말정산-외벌이-절세": "연말정산",
  "연말정산-원천징수영수증": "연말정산",
  "연말정산-월세-세액공제-조건": "세금",
  "연말정산-육아휴직-급여": "세금",
  "연말정산-육아휴직자": "연말정산",
  "연말정산-의료비-공제한도": "연말정산",
  "연말정산-의료비-본인부담금-공제": "세금",
  "연말정산-의료비-세액공제": "세금",
  "연말정산-이직자": "연말정산",
  "연말정산-일용직": "연말정산",
  "연말정산-임플란트": "연말정산",
  "연말정산-자녀-세액공제": "연말정산",
  "연말정산-자주-묻는-질문": "연말정산",
  "연말정산-장기주택저당차입금-공제": "세금",
  "연말정산-장기주택저당차입금": "연말정산",
  "연말정산-장애인-공제": "세금",
  "연말정산-장애인-특수교육비": "세금",
  "연말정산-전세대출-이자": "연말정산",
  "연말정산-전통시장-공제": "세금",
  "연말정산-전통시장": "연말정산",
  "연말정산-절세-체크리스트": "연말정산",
  "연말정산-정치자금-기부금": "세금",
  "연말정산-종교단체-기부금": "세금",
  "연말정산-주민세": "세금",
  "연말정산-주택담보대출-이자": "연말정산",
  "연말정산-주택마련저축-공제": "세금",
  "연말정산-주택마련저축": "연말정산",
  "연말정산-주택임차차입금-공제": "세금",
  "연말정산-주택청약-공제": "세금",
  "연말정산-중도퇴사": "연말정산",
  "연말정산-중복공제-주의사항": "세금",
  "연말정산-중소기업-청년": "연말정산",
  "연말정산-중소기업-취업자-감면": "세금",
  "연말정산-직업훈련비": "연말정산",
  "연말정산-체크카드-공제율": "세금",
  "연말정산-추가공제-종류": "연말정산",
  "연말정산-추가납부-분할": "세금",
  "연말정산-출산-입양-세액공제": "세금",
  "연말정산-취학전-아동-교육비": "세금",
  "연말정산-치과-공제": "세금",
  "연말정산-치과-교정": "연말정산",
  "연말정산-퇴사자": "세금",
  "연말정산-퇴직연금-공제": "연말정산",
  "연말정산-퇴직연금-세액공제": "세금",
  "연말정산-투잡": "연말정산",
  "연말정산-특별재난지역-기부금": "연말정산",
  "연말정산-특별재난지역": "연말정산",
  "연말정산-파트타임": "연말정산",
  "연말정산-표준세액공제": "세금",
  "연말정산-프리랜서": "연말정산",
  "연말정산-학원비-공제": "연말정산",
  "연말정산-학자금-대출-상환-공제": "세금",
  "연말정산-한부모-공제": "세금",
  "연말정산-해외교육비": "연말정산",
  "연말정산-헬스장-수영장-소득공제": "연말정산",
  "연말정산-현금영수증-공제": "세금",
  "연말정산-현금영수증": "연말정산",
  "연말정산-환급금-계산": "세금",
  "연말정산-환급금-조회": "연말정산",
  "연말정산": "세금",
  "연봉-실수령액": "경제",
  "연차휴가": "법률",
  "오피스텔-임대차": "부동산",
  "우선변제권-요건": "부동산",
  "원상복구-범위": "부동산",
  "원천징수": "세금",
  "월세-세액공제": "세금",
  "월세계약-주의사항": "부동산",
  "육아휴직급여": "경제",
  "의료비공제": "세금",
  "인지세": "세금",
  "임대사업자-등록": "부동산",
  "임대인-수리의무": "부동산",
  "임대차-중도해지": "부동산",
  "임대차계약-해제-해지-차이": "부동산",
  "임대차계약서-작성법": "부동산",
  "임대차보호법": "부동산",
  "임대차분쟁조정-신청": "부동산",
  "임차권등기명령": "부동산",
  "임차인-우선매수권": "부동산",
  "자녀세액공제": "세금",
  "자녀장려금": "경제",
  "자동차세": "세금",
  "재개발-재건축": "부동산",
  "재산세": "세금",
  "전세계약-주의사항": "부동산",
  "전세권-설정등기": "부동산",
  "전세금-경매-배당": "부동산",
  "전세보증금-반환-절차": "부동산",
  "전세보증보험": "부동산",
  "전세사기-신고방법": "부동산",
  "전세자금대출-조건": "부동산",
  "전세자금대출": "부동산",
  "전월세-전환율": "부동산",
  "전월세상한제-계산": "부동산",
  "전월세상한제-위반": "부동산",
  "전월세상한제-폐지": "부동산",
  "전월세상한제": "부동산",
  "전월세신고-과태료": "부동산",
  "전월세신고": "부동산",
  "전입신고-방법": "부동산",
  "종합부동산세": "세금",
  "종합소득세-신고": "세금",
  "종합소득세": "세금",
  "주거급여-신청": "부동산",
  "주거용-오피스텔": "부동산",
  "주민세": "세금",
  "주택담보대출": "부동산",
  "주택연금": "경제",
  "주택임대차보호법-시행령": "부동산",
  "주택임대차보호법-위반": "부동산",
  "주택임대차보호법-제3조": "부동산",
  "주택임대차보호법-제4조": "부동산",
  "주택임대차보호법-제6조의2": "부동산",
  "주택임대차보호법-제6조의3": "부동산",
  "주택청약": "부동산",
  "주택청약저축": "부동산",
  "중소기업-취업자-소득세-감면": "세금",
  "증여세": "세금",
  "집주인-변경-임차인-권리": "부동산",
  "청년도약계좌": "경제",
  "최저임금": "경제",
  "출산휴가": "법률",
  "취득세-세율": "부동산",
  "퇴직금-계산-방법": "경제",
  "퇴직금": "근로",
  "퇴직소득세": "세금",
  "퇴직연금": "경제",
  "특별공급": "부동산",
  "해외주식-세금": "세금",
  "확정일자": "부동산",
};

export function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;

  // /w/슬러그 형태의 기존 URL 처리 (카테고리 없는 경우)
  const oldUrlMatch = pathname.match(/^\/w\/([^\/]+)$/);

  if (oldUrlMatch) {
    const slug = decodeURIComponent(oldUrlMatch[1]);

    // 카테고리 매핑에서 찾기
    const category = slugCategoryMap[slug];

    if (category) {
      // 새 URL로 301 리다이렉트
      const newUrl = `/w/${encodeURIComponent(category)}/${encodeURIComponent(slug)}`;
      return NextResponse.redirect(new URL(newUrl, request.url), 301);
    }

    // 매핑에 없으면 홈으로 리다이렉트
    return NextResponse.redirect(new URL("/", request.url), 302);
  }

  return NextResponse.next();
}

export const config = {
  matcher: ["/w/:path*"],
};
